@let questionaire = content.q;
@let qIndex = content.qIndex;
@let question = getQuestion(content)!;

<h1 class="q-title">{{questionaire.title}}</h1>
<br>

<div class="progress-text">{{qIndex + 1}}/{{totalQuestions(content)}}</div>

<mat-progress-bar mode="determinate"
                  [color]="'#080'"
                  [value]="(qIndex + 1) / totalQuestions(content) * 100" />
<br>

@let sub = getSectionTitle(content);
@if(sub) {
<h2 class="q-subtitle">{{sub}}</h2>
}

<h4 class="q-text"
    [class.spacing]="!sub">
  {{question.text}}
</h4>

@if(question.type === 'select') {
@let multiple = isAllowedMultipleChoiceAnswer(question);

<div class="select-q-container">
  @if(multiple) {
  <div class="multiple-choice-answer">
    @for(opt of question.options; track opt.id) {
    <mat-checkbox (change)="saveAnswer(opt.id, $event.checked)"
                  [checked]="getOptionValue(opt.id) ?? false">
      {{ opt.text }}
    </mat-checkbox>
    <br>
    }
  </div>
  } @else {
  <div class="single-choice-answer">
    @for(opt of question.options; track opt.id) {
    <mat-radio-button (change)="saveAnswer(opt.id, $event.source['checked'])"
                      [checked]="getOptionValue(opt.id) ?? false">
      {{ opt.text }}
    </mat-radio-button>
    <br>
    }
  </div>
  }
</div>

<ng-container>
  @let txtVal = getOptionValue(OTHER_OPTION_ID);
  @let openAnsChecked = txtVal != null;

  @if (question.openAnswerInfo) {
  @if(multiple) {
  <mat-checkbox (change)="saveAnswer(OTHER_OPTION_ID, $event.checked ? '' : false)"
                [checked]="openAnsChecked">
    {{ question.openAnswerInfo.text }}
  </mat-checkbox>
  } @else {
  <mat-radio-button (change)="saveAnswer(OTHER_OPTION_ID, $event.source['checked'] ? '' : false)"
                    [checked]="openAnsChecked">
    {{ question.openAnswerInfo.text }}
  </mat-radio-button>
  }

  @if(openAnsChecked) {
  <mat-form-field class="area">
    <textarea matInput
              [value]="txtVal"
              (input)="saveAnswer(OTHER_OPTION_ID, val($event.target))">
    </textarea>
  </mat-form-field>
  }
  }
</ng-container>

}

<div class="buttons">
  <button mat-flat-button
          color="primary"
          [style.visibility]="qIndex === 0 ? 'hidden' : 'visible'"
          (click)="navQuestion(-1, content)">
    Înapoi
  </button>

  <button mat-flat-button
          color="primary"
          [style.visibility]="qIndex === totalQuestions(content) - 1 ? 'hidden' : 'visible'"
          (click)="navQuestion(1, content)">
    Înainte
  </button>
</div>